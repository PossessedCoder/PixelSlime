# PixelSlime

2d игра, написанная на языке **python** с помощью библиотеки **pygame**

##### Авторы:
* Журавлев Александр
* Николаевский Дмитрий
* Годонюк Матвей

<br>

## Идея
Создание игры, в которой пользователь сможет проходить готовые уровни и создавать собственные.

<br>

## Возможности и инструменты
При входе в игру пользователь должен авторизироваться или создать аккаунт. После этого пользователь попадет в меню, из которого сможет перейти в или в редактор уровней, или к готовым уровням. Снизу в центре расположена кнопка для выхода из программы.<br>
При открытии редактора уровней следует навести курсор мыши на панель внизу экрана, чтобы расширить её. На панели расположены кнопки для запуска тестового режима уровня, очистки поля, сохранения уровня и выхода в меню. Правее кнопок находятся тайлы, с помощью которых пользователь сможет создать уровень. При нажатии левой кнопкой мыши (ЛКМ) тайл отмечается как выбранный (появляется обводка голубого цвета). Когда тайл выбран, его можно поместить на игровое поле с помощью нажатия ЛКМ. Когда тайл размещен на поле, его можно повернуть нажатием правой кнопки мыши (ПКМ). Для удаления тайла с поля следует повторно нажать ЛКМ по нему. Поле поддерживает 4 различных темы текстур (lava, rock, sky, purple). Для смены темы следует нажать на одну из 4 кнопок снизу по центру на панели редактора уровней (изменяется только для текущего уровня в редакторе).<br>
В меню уровней находятся 17 заготовленных (системных) уровней. Изначально открыт только уровень под номером 1, остальные уровни являются заблокированными, и вход на них невозможен (значок закрытого замка). Цель игрока на уровне - довести персонажем до выхода (имеет модельку открытой двери). Управление осуществляется нажатием на пробел таким образом, что в момент нажатия персонаж летит по лучу, выходящим из конца стрелки над персонажем. Когда персонаж вылетает за пределы поля, его возвращает на начальную позицию. При прохождении каждого системного уровня разблокируется следующий за ним по номеру уровень, а пройденный уровень отмечается как завершенный (значок галочки). Если на этом уровне присутствовали неразблокированные тайлы (тайлы, которые не встречались пользователю ни на одном пройденном заготовленном уровне), то они становятся разблокированными, и пользователь может использовать их в редакторе уровней. Помимо готовых уровней снизу есть кнопка для просмотра пользовательских уровней, на каждый из которых можно зайти и попытаться завершить.

<br>

## Основные классы и функции

#### Базовые
**`class BaseSurface`** - Базовый класс, от которого наследуются все поверхности<br>
**`class BaseWindow`** - Базовый класс для создания окон. Публикует событие об открытии нового окна для добавления его в стек<br>
**`class Button`** - Кнопка<br>
**`class Panel`** - Всплывающая панель. Изменяет размер от минимального прямоугольника к максимальному прямоугольнику (и в обратную сторону) с постоянной скоростью в зависимости от их координат и значений сторон.<br>
**`class LineEdit`** - Редактируемое поле с текстом (text input)<br>
**`class FormField`** - Поле формы. Может быть скрываемым (закрываться точками), если указан аргумент *secret=True*. Поддерживает добавление ошибок, placeholder, label<br>
**`class Form`** - Форма. Проверки корректности введенных данных в поля формы осуществляется в методе *validate*<br>
**`class Freezer`** - Имеет методы freeze и unfreeze для заморозки и разморозки текущего окна. Используется при открытии формы<br>

#### Пользователи. Авторизация и регистрация
**`class _RegistrationForm`** - Открывает форму для регистрации. Проверяет, что пользователем с указнным логином еще не зарегистрирован. Проверяет длину пароля (должен быть ≥ 6 символов)<br>
**`class _AuthenticationForm`** - Открывает форму для авторизации. Проверяет существование пользователя с указанным логином. Проверяет правильность пароля (пароли хранятся в БД в хэшированном виде)<br>
**`class AuthTabs`** - Открывает формы *_RegistrationForm* и *_AuthenticationForm* при их переключении 

#### Главное  меню
**`class Menu`** - Открывает главное меню<br>

#### Редактор уровней
**`class Editor`** - Открывает редактор уровней<br>
**`class TilesPanel`** - Нижняя панель в редакторе уровней (описана выше в разделе "__Возможности и инструменты__")<br>

#### Меню уровней
**`class Levels`** - Открывает меню уровней<br>
**`class UserLevelsSurface`** - Отображает поверхность с пользовательскими уровнями<br>

#### Уровни
**`class Level`** - Открывает уровень<br>
**`dataclass Coordinates`** - Координаты конкретной клетки на поле (row - строка, col - колонка)<br>
**`class Field`** - Игровое поле. Содержит в себе группу спрайтов (клеток)<br>
**`class Cell`** - Клетка поля. Содержит свои координаты (см. выше *Coordinates*). Является спрайтом<br>

#### Тайлы
**`class Hero`** - Герой<br>
**`class Exit`** - Завершение уровня<br>
**`class Block`** - Блоки<br>
**`class Spike`** - Шипы<br>

#### Утилиты
**`class DataBase`** - Осуществляет все обращения к БД<br>
**`def load_media`** - Загружает указанный медиа-файл. Возвращает *Iterator[pygame.Surface]*, если по указанному пути расположена директория с картинками (например, gif разбитый на кадры), иначе - *pygame.Surface*. Если указан аргумент __repeat=True__, зацикливает медиа-файл с помощью *itertools.cycle*<br>
**`def catch_events`** - Функция, "запоминающая" последнюю очередь событий, возвращенные *pygame.event.get()*. Нужна для того, чтобы иметь доступ к событиям произошедшим за текущий кадр из любого места программы.<br>
**`def get_tiles`** - Находит все имеющиеся в программе тайлы и возвращает их. Принимает неограниченной количество позиционных аргументов **names* - названия тайлов, которые следует вернуть<br>



<br>

## Структура БД
#### В БД находятся 4 таблицы:<br>
<pre>
users
├── INTEGER uid     # id пользователя
├── TEXT login     # логин пользователя
└── TEXT password     # пароль пользователя (в хэшированном виде)
</pre>
<pre>
levels
├── INTEGER id     # id уровня
├── TEXT name     # название уровня
├── INTEGER author_id     # id создателя уровня
└── TEXT pack     # тема, которая должна быть загружена на блок
</pre>
<pre>
completedLevels
├── INTEGER level_id     # id пройденного уровня
├── INTEGER uid     # id пользователя, завершившего уровень
└── REAL time     # время прохождения (секунды.миллисекунды)
</pre>
<pre>
tiles
├── INTEGER id     # id тайла
├── TEXT rowcol     # позиция тайла на поле (row col)
├── TEXT tilename     # название тайла
├── INTEGER level_id     # id уровня, которому принадлежит данный тайл
└── INTEGER angle     # угол, на который нужно повернуть тайл при выгрузке на поле
</pre>
